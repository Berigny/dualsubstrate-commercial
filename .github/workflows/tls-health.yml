name: TLS smoke test

on:
  push:
    paths:
      - "api/**"
      - "proto/**"
      - "sdk/python/**"
      - "Makefile"
      - "requirements.txt"
      - "api/requirements.grpc.txt"
      - "ops/Dockerfile"
      - "docker-compose.tls.yml"
      - ".github/workflows/tls-health.yml"
  pull_request:

permissions:
  contents: read
  packages: read

jobs:
  health:
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Smoke test – REST health endpoint
        run: |
          curl -f https://dualsubstrate-commercial.fly.dev/health > /dev/null \
            && echo "✅ API healthy" || (echo "❌ API down" && exit 1)
