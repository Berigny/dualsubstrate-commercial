name: TLS smoke test

on:
  push:
    paths:
      - "api/**"
      - "proto/**"
      - "sdk/python/**"
      - "Makefile"
      - "requirements.txt"
      - "api/requirements.grpc.txt"
      - "ops/Dockerfile"
      - "docker-compose.tls.yml"
      - ".github/workflows/tls-health.yml"
  pull_request:

permissions:
  contents: read
  packages: read

jobs:
  health:
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Smoke test – REST /schema endpoint
        env:
          DUALSUBSTRATE_API_KEY: ${{ secrets.DUALSUBSTRATE_API_KEY }}
        run: |
          curl -f -H "x-api-key: ${DUALSUBSTRATE_API_KEY}" \
               https://dualsubstrate-commercial.fly.dev/schema?entity=demo_user \
               > /dev/null && echo "✅ API up" || (echo "❌ API down" && exit 1)
